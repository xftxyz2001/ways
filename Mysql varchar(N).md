在数据库设计时，为了节约磁盘存储空间和内存空间，以及应用程序处理效率，varchar的长度应当如何设置？

## 1. varchar的存储
varchar字段长度 = 字符串长度值 + 实际数据长度 N。

字符串长度值视实际数据长度，需占用 1 或 2 个字节存储。所以：
- 当实际数据长度 $\le$ 255 时，varchar字段长度 = 1 + N
- 当实际数据长度 $\gt$ 255 时，varchar字段长度 = 2 + N

varchar主要根据字段实际使用的长度来分配存储空间


## 2. 长度的设置（设字符串实际数据长度N）

### $0 \lt N \le 64$ :根据实际数据长度N，选择一个相近的 $2^n$ 长度：
- `varchar(8)`, `varchar(16)`, `varchar(32)`, `varchar(64)`

例
1. 手机号11位，可以选择varchar(16)

原因：
- `1 bytes = 8 bit` ，一个字节最多可以代表的数据长度是2的8次方 `11111111` 在计算机中也就是-128到127。
- 使用 $2^n$ 长度是更好的磁盘或内存块对齐。
- 对齐块更快。今天“块”的大小更大，内存和磁盘足够快，可以忽略对齐，对于非常大的块来说是非常重要的。

### $N \gt 64$ :根据实际数据长度N，选择一个相近的 $2^{n-1}$ 长度：
- `varchar(127)`, `varchar(255)`, `varchar(511)`, ...

例
1. 收货地址接近100个字符，可以选择varchar(127)
2. 商品名称，接近256个字符，可以选择varchar(255)

原因：
1. 方便InnoDB建索引，对于 MyISAM，可以对前 1000 个字节做索引，对于 InnoDB，则只有 767 字节。（来源依据）。255X3=765
2. 少申请一个字节，记录字符串长度，一个8位的tinyint，可以表示的无符号数值的范围是，0-255，如果长度超过了255，需要在申请个字节。
3. 磁盘块和内存块对齐

补充说明：
- varchar(N)长度并不是越长，越好，需要选择一个合适的长度。
- 因为：在内存中的操作方式，varchar也是按照最长的方式在内存中进行操作的。比如说要进行排序的时候，varcahr(100)是按照100这个长度来进行的，不合理的长度会浪费内存空间。


## 参考
- [CSDN-mysql varchar(N)长度如何选择](https://blog.csdn.net/u011582840/article/details/105887826)
